#/bin/bash

ARUSPIX_ROOT=../

if [ ! -d build ]; then mkdir build; fi

if [ ! -d data ]; then mkdir data; fi

echo "Sync svg resources"
cp -r ../data/svg data/

emcc --closure 0 -O2 \
	-I$ARUSPIX_ROOT/src \
	-DCMD_LINE \
	-DUSE_FAKE_UUIDS \
	$ARUSPIX_ROOT/src/mus/main.cpp \
	$ARUSPIX_ROOT/src/mus/mus.cpp \
	$ARUSPIX_ROOT/src/mus/musapp.cpp \
	$ARUSPIX_ROOT/src/mus/musbarline.cpp \
	$ARUSPIX_ROOT/src/mus/musmeasure.cpp \
	$ARUSPIX_ROOT/src/mus/musbboxdc.cpp \
	$ARUSPIX_ROOT/src/mus/musbeam.cpp \
	$ARUSPIX_ROOT/src/mus/musclef.cpp \
	$ARUSPIX_ROOT/src/mus/musdc.cpp \
	$ARUSPIX_ROOT/src/mus/musdoc.cpp \
	$ARUSPIX_ROOT/src/mus/musdurationinterface.cpp \
	$ARUSPIX_ROOT/src/mus/musio.cpp \
	$ARUSPIX_ROOT/src/mus/musiodarms.cpp \
	$ARUSPIX_ROOT/src/mus/musiomei.cpp \
	$ARUSPIX_ROOT/src/mus/musiomusxml.cpp \
	$ARUSPIX_ROOT/src/mus/musiopae.cpp \
	$ARUSPIX_ROOT/src/mus/muskeysig.cpp \
	$ARUSPIX_ROOT/src/mus/muslayer.cpp \
	$ARUSPIX_ROOT/src/mus/muslayerelement.cpp \
	$ARUSPIX_ROOT/src/mus/musleipzigbbox.cpp \
	$ARUSPIX_ROOT/src/mus/musmensur.cpp \
	$ARUSPIX_ROOT/src/mus/musnote.cpp \
	$ARUSPIX_ROOT/src/mus/musobject.cpp \
	$ARUSPIX_ROOT/src/mus/muspage.cpp \
	$ARUSPIX_ROOT/src/mus/muspitchinterface.cpp \
	$ARUSPIX_ROOT/src/mus/muspositioninterface.cpp \
	$ARUSPIX_ROOT/src/mus/musrc.cpp \
	$ARUSPIX_ROOT/src/mus/musrc_beam.cpp \
	$ARUSPIX_ROOT/src/mus/musrc_bezier.cpp \
	$ARUSPIX_ROOT/src/mus/musrc_element.cpp \
	$ARUSPIX_ROOT/src/mus/musrc_graph.cpp \
	$ARUSPIX_ROOT/src/mus/musrc_page.cpp \
	$ARUSPIX_ROOT/src/mus/musrc_tuplet.cpp \
	$ARUSPIX_ROOT/src/mus/musrest.cpp \
	$ARUSPIX_ROOT/src/mus/musslur.cpp \
	$ARUSPIX_ROOT/src/mus/musstaff.cpp \
	$ARUSPIX_ROOT/src/mus/mussvgdc.cpp \
	$ARUSPIX_ROOT/src/mus/mussymbol.cpp \
	$ARUSPIX_ROOT/src/mus/mussystem.cpp \
	$ARUSPIX_ROOT/src/mus/mustie.cpp \
	$ARUSPIX_ROOT/src/mus/mustuplet.cpp \
	$ARUSPIX_ROOT/src/mus/musuuid.cpp \
	$ARUSPIX_ROOT/src/tinyxml/tinystr.cpp \
	$ARUSPIX_ROOT/src/tinyxml/tinyxml.cpp \
	$ARUSPIX_ROOT/src/tinyxml/tinyxmlerror.cpp \
	$ARUSPIX_ROOT/src/tinyxml/tinyxmlparser.cpp \
	lib/regex/regcomp.c \
	lib/regex/regexec.c \
	lib/regex/regfree.c \
	lib/regex/regerror.c \
	--embed-file data/svg/ \
	-s EXPORTED_FUNCTIONS="['_pae2svg']" \
    -o build/aruspix.js

# Unused
#/Users/xhero/Downloads/e2fsprogs-1.42.8/lib/uuid/result.bc \
#--embed-file data/svg/ \
#	llvm_regexp/regcomp.c \
#	llvm_regexp/regexec.c \
#	llvm_regexp/regfree.c \
#	llvm_regexp/regerror.c \
#	llvm_regexp/regstrlcpy.c \

#	apple_regex/regcomp.c \
#	apple_regex/regexec.c \
#	apple_regex/regfree.c \
#	apple_regex/regerror.c \
